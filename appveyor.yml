version: '{build}'
image: Visual Studio 2017
configuration: Release
platform: Any CPU
init:
- ps: IF ($env:APPVEYOR_REPO_BRANCH -eq "develop") {$env:APPVEYOR_CACHE_SKIP_SAVE = "true"}
install:
- cmd: choco install gitversion.portable -version 4.0.0-beta0012 -pre -y
cache: packages -> **\packages.config
nuget:
  account_feed: true
  project_feed: true
  disable_publish_on_pr: true
before_build:
- ps: >-
    .\init.ps1;
    & .\.tools\nuget.exe restore -NonInteractive -DisableParallelProcessing;
    gitversion /l console /output buildserver;
build:
  publish_nuget: true
  publish_nuget_symbols: true
  include_nuget_references: true
  parallel: true
  verbosity: minimal
test:
  assemblies:
    except:
    - '**\*IntegrationTests.dll'
  categories:
    except:
    - localOnly
    - Benchmark
    - SOAP
    - REST
artifacts:
- path: '*.nupkg'
  name: NuGet
- path: Benchmark-report.html
  name: BDN
deploy:
- provider: NuGet
  server: https://www.myget.org/F/qwiq/api/v2/package
  api_key:
    secure: 8wGYx8W+ojYQJsAJpRLez+KwwFa+OW7cvsn5RoR08WQpi5klhTq/9b/9YaEu/5Bx
  symbol_server: https://www.myget.org/F/qwiq/symbols/api/v2/package
  on:
    branch: dev(elop)?(ment)?$
    GitVersion_PreReleaseLabel: ''
- provider: NuGet
  server: https://www.myget.org/F/qwiq/api/v2/package
  api_key:
    secure: 8wGYx8W+ojYQJsAJpRLez+KwwFa+OW7cvsn5RoR08WQpi5klhTq/9b/9YaEu/5Bx
  symbol_server: https://www.myget.org/F/qwiq/symbols/api/v2/package
  on:
    branch: master
    GitVersion_PreReleaseLabel: ''
- provider: NuGet
  server: https://www.myget.org/F/qwiq/api/v2/package
  api_key:
    secure: 8wGYx8W+ojYQJsAJpRLez+KwwFa+OW7cvsn5RoR08WQpi5klhTq/9b/9YaEu/5Bx
  symbol_server: https://www.myget.org/F/qwiq/symbols/api/v2/package
  on:
    branch: releases?[/-]
    GitVersion_PreReleaseLabel: ''
- provider: NuGet
  server: https://www.myget.org/F/qwiq/api/v2/package
  api_key:
    secure: 8wGYx8W+ojYQJsAJpRLez+KwwFa+OW7cvsn5RoR08WQpi5klhTq/9b/9YaEu/5Bx
  symbol_server: https://www.myget.org/F/qwiq/symbols/api/v2/package
  on:
    branch: support[/-]
    GitVersion_PreReleaseLabel: ''
notifications:
- provider: GitHubPullRequest
  on_build_success: false
  on_build_failure: true
  on_build_status_changed: true
